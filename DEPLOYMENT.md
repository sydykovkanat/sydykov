# Deployment Guide

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ VPS —á–µ—Ä–µ–∑ GitHub Actions.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **GitHub Actions**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ `main`
- **VPS**: Redis, PostgreSQL, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2
- **SSH Deploy**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SSH –∫–ª—é—á–∏
- **Environment**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ GitHub Secrets

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS

–ù–∞ —Ç–≤–æ–µ–º VPS –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```bash
# Node.js 18+
node -v

# Yarn
yarn -v

# PM2
pm2 -v

# Git
git -v

# PostgreSQL (—É–∂–µ –µ—Å—Ç—å)
# Redis (—É–∂–µ –µ—Å—Ç—å)
```

–ö–ª–æ–Ω–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ VPS:

```bash
cd ~
git clone <repository-url> sydykov
cd sydykov
yarn install
```

–°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª –Ω–∞ VPS:

```bash
nano ~/sydykov/.env
```

–í—Å—Ç–∞–≤—å —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–º. `.env.example`).

–°–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π –±–∏–ª–¥ –∏ –∑–∞–ø—É—Å–∫:

```bash
yarn build
npx prisma migrate deploy
npx prisma generate
pm2 start dist/main.js --name sydykov
pm2 save
pm2 startup
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–ü–µ—Ä–µ–π–¥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitHub: **Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret**

–î–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

1. **VPS_HOST**
   - –ó–Ω–∞—á–µ–Ω–∏–µ: IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Ç–≤–æ–µ–≥–æ VPS
   - –ü—Ä–∏–º–µ—Ä: `123.45.67.89` –∏–ª–∏ `vps.example.com`

2. **VPS_USERNAME**
   - –ó–Ω–∞—á–µ–Ω–∏–µ: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH
   - –ü—Ä–∏–º–µ—Ä: `root` –∏–ª–∏ `ubuntu`

3. **VPS_SSH_KEY**
   - –ó–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ VPS
   - **–í–ê–ñ–ù–û**: –ö–ª—é—á –±–µ—Ä–µ—Ç—Å—è —Å **–ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã**, –ù–ï —Å VPS!
   - –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:

     ```bash
     # –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (—Ç–≤–æ–π Mac/PC)
     cat ~/.ssh/id_rsa

     # –ï—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π:
     ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
     # –ù–∞–∂–∏–º–∞–π Enter –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
     ```

   - –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å –∫–ª—é—á –≤–∫–ª—é—á–∞—è `-----BEGIN OPENSSH PRIVATE KEY-----` –∏ `-----END OPENSSH PRIVATE KEY-----`
   - –≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á - –¥–µ—Ä–∂–∏ –µ–≥–æ –≤ —Å–µ–∫—Ä–µ—Ç–µ!

4. **ENV_FILE**
   - –ó–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–≤–æ–µ–≥–æ `.env` —Ñ–∞–π–ª–∞
   - **–í–ê–ñ–ù–û**: –≠—Ç–æ—Ç —Ñ–∞–π–ª –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –Ω–∞ VPS –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ
   - –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:

     ```bash
     # –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∫–æ–ø–∏—Ä—É–π —Å VPS (–µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å)
     ssh username@vps-host "cat ~/sydykov/.env"

     # –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–π –ª–æ–∫–∞–ª—å–Ω—ã–π .env (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
     cat .env

     # –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑—É–π helper —Å–∫—Ä–∏–ø—Ç
     ./scripts/env-backup.sh
     ```

   - –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º –∏ –≤—Å—Ç–∞–≤—å –≤ GitHub Secret
   - –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `.env` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

5. **VPS_PORT** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SSH –ø–æ—Ä—Ç)
   - –ó–Ω–∞—á–µ–Ω–∏–µ: –ø–æ—Ä—Ç SSH
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `22`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

**–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (—Ç–≤–æ–π Mac/PC):**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å –µ—Å—Ç—å –ª–∏ SSH –∫–ª—é—á
ls ~/.ssh/id_rsa

# 2. –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∫–ª—é—á
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
# –ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–∏–º–∞–π Enter –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã (–∏–ª–∏ –∑–∞–¥–∞–π passphrase –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

# 3. –°–∫–æ–ø–∏—Ä—É–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VPS
ssh-copy-id root@your-vps-ip
# –í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å –æ—Ç VPS (–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑!)

# 4. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è
ssh root@your-vps-ip
# –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–µ—Å–ª–∏ ssh-copy-id –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ - –≤—ã–≤–µ–¥–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/id_rsa.pub

# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ VPS –ø–æ –ø–∞—Ä–æ–ª—é
ssh root@your-vps-ip

# –ù–∞ VPS - –¥–æ–±–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
mkdir -p ~/.ssh
chmod 700 ~/.ssh
nano ~/.ssh/authorized_keys
# –í—Å—Ç–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–∏–∑ id_rsa.pub) –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
# –°–æ—Ö—Ä–∞–Ω–∏: Ctrl+O, Enter, Ctrl+X

chmod 600 ~/.ssh/authorized_keys
exit

# –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è
ssh root@your-vps-ip
```

---

## üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π push –≤ `main`:

```bash
git add .
git commit -m "your changes"
git push origin main
```

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ VPS
2. –°–¥–µ–ª–∞–µ—Ç `git pull`
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. –ó–∞–ø—É—Å—Ç–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
5. –°–æ–±–µ—Ä–µ—Ç –ø—Ä–æ–µ–∫—Ç
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç PM2

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–ù–∞ VPS –º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è:

```bash
cd ~/sydykov
./scripts/deploy.sh
```

–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å GitHub Action –≤—Ä—É—á–Ω—É—é:

- –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Actions** –≤ GitHub
- –í—ã–±–µ—Ä–∏ **Deploy to VPS**
- –ù–∞–∂–º–∏ **Run workflow**

---

## üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±: –ß–µ—Ä–µ–∑ GitHub Secrets (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ `.env` —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ VPS –∏–∑ GitHub Secret `ENV_FILE`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (GitHub Secrets)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Git (–±–µ–∑ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ)

**–ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

1. –ü–µ—Ä–µ–π–¥–∏ –≤ **Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí ENV_FILE**
2. –ù–∞–∂–º–∏ **Update** (–∫–∞—Ä–∞–Ω–¥–∞—à —Å–ø—Ä–∞–≤–∞)
3. –û–±–Ω–æ–≤–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env` —Ñ–∞–π–ª–∞
4. –°–æ—Ö—Ä–∞–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –°–¥–µ–ª–∞–π –ª—é–±–æ–π push –≤ `main` –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏ workflow –≤—Ä—É—á–Ω—É—é
6. `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**–ü–µ—Ä–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª—É—á–∏ —Ç–µ–∫—É—â–∏–π .env —Å VPS
ssh username@vps-host "cat ~/sydykov/.env"

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–π helper —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./scripts/env-backup.sh

# –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å –≤—ã–≤–æ–¥ –∏ –¥–æ–±–∞–≤—å –≤ GitHub Secret ENV_FILE
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ù–∞–ø—Ä—è–º—É—é –Ω–∞ VPS (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ!

```bash
ssh username@vps-host
cd ~/sydykov
nano .env
# –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
pm2 restart sydykov
```

–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª `.env` –Ω–∞ VPS, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –æ–±–Ω–æ–≤–∏ GitHub Secret `ENV_FILE`, –∏–Ω–∞—á–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ.

### –ë—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–≥–æ .env —Å VPS

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π helper —Å–∫—Ä–∏–ø—Ç
./scripts/env-backup.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
ssh username@vps-host "cat ~/sydykov/.env" > .env.backup
```

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ù–∞ VPS

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status sydykov

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
pm2 logs sydykov

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 restart sydykov

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
pm2 stop sydykov

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 monit
```

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å workflow
cat .github/workflows/deploy.yml

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VPS
ssh username@vps-host
```

---

## üêõ Troubleshooting

### –î–µ–ø–ª–æ–π –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ workflow –≤–∫–ª—é—á–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ Actions –Ω–∞ GitHub
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã

### –û—à–∏–±–∫–∞ SSH

```
Permission denied (publickey)
```

**–†–µ—à–µ–Ω–∏–µ:**

- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys` –Ω–∞ VPS
- –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞: `chmod 600 ~/.ssh/authorized_keys`

### PM2 –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ù–∞ VPS
cd ~/sydykov
pm2 delete sydykov
pm2 start dist/main.js --name sydykov
pm2 save
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å

```bash
# –ù–∞ VPS
cd ~/sydykov
npx prisma migrate deploy
npx prisma generate
pm2 restart sydykov
```

### –û—à–∏–±–∫–∞ "command not found" (yarn, node, pm2)

```
bash: line 7: yarn: command not found
bash: line 17: pm2: command not found
```

**–ü—Ä–∏—á–∏–Ω–∞:** SSH —Å–µ—Å—Å–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç PATH –¥–ª—è Node.js/npm/yarn.

**–†–µ—à–µ–Ω–∏–µ 1** (—É–∂–µ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö):
–°–∫—Ä–∏–ø—Ç—ã —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
git add .
git commit -m "fix: update deployment scripts"
git push origin main
```

**–†–µ—à–µ–Ω–∏–µ 2** (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è):
–ù–∞ VPS –ø—Ä–æ–≤–µ—Ä—å –≥–¥–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ VPS
ssh root@your-vps-ip

# –ü—Ä–æ–≤–µ—Ä—å Node.js
which node
which npm
which yarn
which pm2

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å nvm
source ~/.nvm/nvm.sh
nvm use node

# –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω–æ
echo $PATH
```

**–†–µ—à–µ–Ω–∏–µ 3** (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–Ω–æ–≤–æ):

```bash
# –ù–∞ VPS - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install --lts
npm install -g yarn pm2
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è

```
GitHub Push ‚Üí GitHub Actions ‚Üí SSH to VPS ‚Üí Deploy Script ‚Üí PM2 Restart
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

1. **Git Pull**: –°–∫–∞—á–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. **Dependencies**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`yarn install`)
3. **Migrations**: –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (`prisma migrate deploy`)
4. **Build**: –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è TypeScript ‚Üí JavaScript
5. **Restart**: PM2 –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –í—Ä–µ–º—è –¥–µ–ø–ª–æ—è

–û–±—ã—á–Ω–æ **2-3 –º–∏–Ω—É—Ç—ã**:

- GitHub Actions: ~30 —Å–µ–∫
- SSH + Git Pull: ~10 —Å–µ–∫
- Dependencies: ~1 –º–∏–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)
- Build: ~30 —Å–µ–∫
- Restart: ~5 —Å–µ–∫

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω–æ:**

- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å `.env` –≤ Git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub Secrets
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å SSH –¥–æ—Å—Ç—É–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ fail2ban)
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–°–µ–∫—Ä–µ—Ç—ã:**

–í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GitHub Secrets:

- API –∫–ª—é—á–∏ (OpenAI, Telegram)
- –°—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- SSH –∫–ª—é—á–∏
- –ü–∞—Ä–æ–ª–∏

---

## üéØ Next Steps

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD –º–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å:

1. **Tests –≤ CI**: –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
2. **Staging Environment**: –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–º
3. **Rollback**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
4. **Monitoring**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
5. **Backups**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î

–ü—Ä–∏–º–µ—Ä—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ [.github/workflows/deploy.yml](.github/workflows/deploy.yml).
